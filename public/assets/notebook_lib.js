function toint(t){return"0"===t?0:parseInt(t,10)||t}function decode_response(t){return JSON.parse(t,function(t,e){return"string"==typeof t&&"id"===t.slice(-2)?toint(e):e})}function encode_response(t){return JSON.stringify(t)}function initialize_the_notebook(){var t,e,i,n,s;try{e=navigator,i=e.appVersion,n=e.appName,s=e.userAgent,browser_op=-1!==s.indexOf("Opera"),browser_saf=-1!==s.indexOf("Safari"),browser_iphone=-1!==s.indexOf("iPhone"),browser_konq=browser_saf||-1===s.indexOf("Konqueror")?!1:!0,browser_moz=browser_saf||browser_konq||-1===s.indexOf("Gecko")?!1:!0,browser_ie=-1!==n.indexOf("Internet Explorer")&&!browser_op,os_mac=-1!==i.indexOf("Mac"),os_win=-1===i.indexOf("Win")&&-1===i.indexOf("NT")||os_mac?!1:!0,os_lin=-1!==s.indexOf("Linux")}catch(o){alert(o)}for(get_keyboard(),cell_id_list=$.map(cell_id_list,function(t){return is_compute_cell(t)&&halt_introspection(t),toint(t)}),t=0;t<queue_id_list.length;t+=1)queue_id_list[t]=toint(queue_id_list[t]),cell_set_running(queue_id_list[t]);for(queue_id_list.length&&start_update_check(),t=0;t<queue_id_list.length;t+=1)queue_id_list[t]=toint(queue_id_list[t]),cell_set_running(queue_id_list[t]);queue_id_list.length&&start_update_check(),onload_id_list=$.map(onload_id_list,function(t){return t=toint(t),evaluate_cell(t,0),t}),previous.height=$(document.documentElement).height(),previous.width=$(document.documentElement).width(),$(window).resize(function(){var t,e;t=$(document.documentElement).height(),e=$(document.documentElement).width(),(t!==previous.height||e!==previous.width)&&(resize_all_cells(),previous.height=t,previous.width=e)}),$(document).on("paste","textarea",function(){var t=$(this).attr("id").slice(11);setTimeout(function(){send_cell_input(t),cell_input_resize(t)},keypress_resize_delay)}),t=worksheet_filename.indexOf("/"),-1!==t&&"_sage_"===worksheet_filename.slice(0,t)&&$(window).unload(function(){quit_sage()}),bind_events()}function bind_events(){$("body").on("focus","textarea.cell_input",function(){var t=$(this).attr("id"),e=get_cell_id_from_id(t);return cell_focused(this,e),!0}),$("body").on("focus","textarea.cell_input_hide",function(){var t=$(this).attr("id"),e=get_cell_id_from_id(t);return cell_focused(this,e),!0}),$("body").on("blur","textarea.cell_input_active",function(){var t=$(this).attr("id"),e=get_cell_id_from_id(t);return cell_blur(e),!0}),$("body").on("keyup","textarea.cell_input_active",function(t){var e=$(this).attr("id"),i=get_cell_id_from_id(e);return input_keyup(i,t)}),$("body").on("keydown","textarea.cell_input_active",function(t){var e=$(this).attr("id"),i=get_cell_id_from_id(e);return input_keydown(i,t)}),$("body").on("keypress","textarea.cell_input_active",function(t){var e=$(this).attr("id"),i=get_cell_id_from_id(e);return input_keypress(i,t)}),$("body").on("click","input.eval_button_active",function(){var t=$(this).attr("id"),e=get_cell_id_from_id(t);evaluate_cell(e,0)})}function get_cell_id_from_id(t){var e=/[0-9]+/,i=e.exec(t),n=toint(i[0]);return n}function true_function(){return!0}function get_keyboard(){var t,e,i=!1;input_keypress=cell_input_key_event,input_keydown=true_function,browser_op?t="o":browser_ie?(t="i",input_keypress=true_function,input_keydown=cell_input_key_event):browser_saf?(t="s",input_keypress=true_function,input_keydown=cell_input_key_event):browser_konq?(t="k",i=!0):t="m",e=os_mac?"m":os_lin?"l":"w",t&&e&&!i||alert(translations["Your browser / OS combination is not supported.\\nPlease use Firefox or Opera under Linux, Windows, or Mac OS X, or Safari."]),$.getScript("/javascript/dynamic/keyboard/"+t+e)}function get_element(t){var e=$("#"+t);return e.length?e[0]:null}function set_class(t,e){$("#"+t).attr("class",e)}function key_event(t){return t=t||window.event,this.v=0,t.altKey&&(this.v+=1),t.ctrlKey&&(this.v+=2),t.shiftKey&&(this.v+=4),this.m=t.keyCode+","+t.which,this}function time_now(){return(new Date).getTime()}function current_selection(t){var e;return browser_ie?(e=document.selection.createRange(),e.text):t.value.substring(t.selectionStart,t.selectionEnd)}function get_selection_range(t){var e,i,n,s;return browser_ie?(i=document.selection.createRange(),s=i.duplicate(),s.moveToElementText(t),s.setEndPoint("endToStart",i),n=s.text.length,s=i.duplicate(),s.moveToElementText(t),s.setEndPoint("endToEnd",i),e=s.text.length,[n,e]):[t.selectionStart,t.selectionEnd]}function set_selection_range(t,e,i){var n;browser_ie?(t.value=t.value.replaceAll("\r\n","\n"),n=document.selection.createRange(),n.moveToElementText(t),n.moveStart("character",e),n.setEndPoint("endToStart",n),n.moveEnd("character",i-e),n.select()):(t.selectionStart=e,t.selectionEnd=i)}function get_cursor_position(t){return get_selection_range(t)[1]}function set_cursor_position(t,e){set_selection_range(t,e,e)}function hide_java_applets(){$(".jmol_applet").each(function(){var t=$(this),e=t.width(),i=t.height();t.css({marginLeft:"-"+(e+1e3)+"px"}),t.after($('<table><tbody><tr><td align="center" valign="middle">'+translations["Java Applet Hidden"]+"</td></tr></tbody></table>").css({marginTop:"-"+i.toString()+"px",width:e.toString()+"px",height:i.toString()+"px",border:"1px solid black",backgroundColor:"#ccc",color:"black"}))})}function show_java_applets(){$(".jmol_applet").each(function(){$(this).css({marginLeft:"0px"}).next().remove()})}function modal_prompt(t,e,i){var n,s,o,a,r,l,h,u,c,d,f,p;e=e||{},n=e.title||"",s=e.message||"",o=e["default"]||"",a=e.submit||"OK",r=e.css||{},u=e.overlay_close,"undefined"==typeof e.overlay_close&&(u=!0),c=e.close_behavior||"destroy",d=function(){"destroy"===c?(l.dialog("destroy"),l.remove()):"close"===c?l.dialog("close"):"function"==typeof c&&c(),show_java_applets()},i=$.extend({autoOpen:!0,bgiframe:!0,modal:!0,width:"20em",close:d},i),l=$($.parseHTML(modal_prompt_element)),$("body").append(l),l.css(r),h=l.find("form"),e.id&&l.attr("id",e.id),e.form_id&&h.attr("id",e.form_id),l.find("div.message").html(s),f=l.find("input","div.field").attr("value",o).css("width","100%"),l.find('button[type="submit"]').html(a),i.title=i.title||n,u&&$(document).on("click","div.ui-widget-overlay",d),p=t.success,t.success=function(){p(h,l),d()},h.ajaxForm(t),hide_java_applets(),l.dialog(i),f.select()}function refresh(){window.location.replace(location.href)}function refresh_cell_list(){async_request(worksheet_command("cell_list"),refresh_cell_list_callback)}function refresh_cell_list_callback(t,e){var i,n,s;"success"===t&&(n=decode_response(e),state_number=parseInt(n.state_number,10),s=get_element(current_cell),s&&(i=s.innerHTML),refresh(),s&&(s=get_element(current_cell),s.innerHTML=i,cell_input_resize(current_cell),jump_to_cell(current_cell,0)))}function is_whitespace(t){var e=whitespace_pat.exec(t);return e[1]===t}function first_variable_name_in_string(t){var e=one_word_pat.exec(t);return null===e?t:e[1]}function lstrip(t){for(var e=0,i=t.length;i>e&&(" "===t[e]||"\n"===t[e]||"	"===t[e]);)e+=1;return t.slice(e)}function resize_all_cells(){var t,e,i=cell_id_list.length;for(t=0;i>t;t+=1)e=cell_id_list[t],is_compute_cell(e)&&"cell_input_hide"!==get_cell(e).className&&cell_input_resize(e)}function input_keyup(t,e){var i,n,s,o,a,r,l;return t=toint(t),skip_keyup?(skip_keyup=!1,!1):(r=time_now(),r-last_keypress_resize>keypress_resize_delay?(last_keypress_resize=r,cell_input_resize(t)):will_resize_soon||(will_resize_soon=!0,setTimeout(function(){cell_input_resize(t),will_resize_soon=!1},keypress_resize_delay)),browser_iphone||(n=new key_event(e),n&&key_enter(n)&&(i=get_cell(t),a=get_cursor_position(i),l=text_cursor_split(i),o=/(?:\n|^)( *)(?:.*?)(:?)[ \t\r\v\f]*\n$/.exec(l[0]),o&&(s=o[1],":"===o[2]&&(s+="    "),i.value=l[0]+s+l[1],set_cursor_position(i,a+s.length)))),void 0)}function handle_introspection(t,e,i){var n,s,o,a,r=!0;if(o=introspect[t],o.replacing&&!o.docstring){if(s=o.replacement_col,a=o.replacement_row,key_menu_up(i)){if(a-=1,!replacement_element_exists(t,a,s)){for(a=1;replacement_element_exists(t,a,s);)a+=1;a-=1}}else if(key_menu_down(i))a+=1,replacement_element_exists(t,a,s)||(a=0);else if(key_menu_right(i))s+=1,replacement_element_exists(t,a,s)||(s=0);else if(key_menu_left(i)){if(s-=1,!replacement_element_exists(t,a,s)){for(s=1;replacement_element_exists(t,a,s);)s+=1;s-=1}}else r=!1;if(r)return select_replacement_element(t,a,s),!1;if(key_menu_pick(i))return do_replacement(t,o.replacement_word,!0),skip_keyup=!0,!1}if(key_request_introspections(i)){if(o.changed)return o.changed=!1,evaluate_cell_introspection(t,null,null),!1;if(!o.replacing&&o.docstring)return n=o.before_replacing_word,"??"===n.slice(-2)?n=n.slice(0,-1):n+="?",o.before_replacing_word=n,evaluate_cell_introspection(t,n,o.after_cursor),!1;if(o.replacing&&!o.docstring)return o.docstring=!0,evaluate_cell_introspection(t,o.before_replacing_word+o.replacement_word+"?",o.after_cursor),!1;if(o.replacing&&o.docstring)return o.docstring=!1,evaluate_cell_introspection(t,o.before_replacing_word+o.replacing_word,o.after_cursor),!1}else if(key_close_helper(i))return halt_introspection(t),!1;return o.replacing&&!o.docstring&&halt_introspection(t),!0}function do_replacement(t,e,i){var n,s;t=toint(t),n=get_cell(t),cell_focus(t,!1),i&&(e=first_variable_name_in_string(e)),n.value=introspect[t].before_replacing_word+e+introspect[t].after_cursor,s=introspect[t].before_replacing_word.length+e.length,set_cursor_position(n,s),halt_introspection(t)}function get_replacement_element(t,e,i){return get_element("completion"+t+"_"+e+"_"+i)}function replacement_element_exists(t,e,i){var n=get_replacement_element(t,e,i);return null!==n&&""!==$.trim($(n).text())}function select_replacement_element(t,e,i){var n,s;t=toint(t),s=introspect[t],n=get_replacement_element(t,s.replacement_row,s.replacement_col),n&&(n.className="completion_menu_two",s.replacement_row=toint(e),s.replacement_col=toint(i),n=get_replacement_element(t,s.replacement_row,s.replacement_col),n&&(n.className="completion_menu_two completion_menu_selected",s.replacement_word=$.trim($(n).text())||s.replacement_word))}function update_introspection_text(t,e){var i=introspect[t],n=$("#introspect_div_"+t);if(0!=n.length)if(i.loaded){n.html(e);try{MathJax.Hub.Queue(["Typeset",MathJax.Hub,n.get(0)])}catch(s){n.html("Error typesetting mathematics"+n.html())}n.find(".docstring").prepend('<div class="click-message" style="cursor: pointer">'+translations["Click here to pop out"]+'</div><div class="unprinted-note">'+translations.unprinted+"</div>"),i.replacing&&!i.docstring&&select_replacement_element(t,i.replacement_row,i.replacement_col)}else n.html(e)}function halt_introspection(t){var e;t=toint(t),introspect[t]||(introspect[t]={}),e=introspect[t],e.loaded=!1,update_introspection_text(t,""),e.changed=!1,e.docstring=!1,e.replacing=!1,e.replacing_word="",e.replacement_word="",e.replacement_col=0,e.replacement_row=0}function paren_jump(t,e,i,n){var s=e;n&&(s+=1),t.value=t.value.substring(0,e)+i+t.value.substring(s),set_cursor_position(t,e+i.length)}function paren_match(t){var e,i,n,s,o,a=!1,r=[],l=!1,h=[],u="",c="'",d='"',f="#",p="\n",g="\\",m="",v="(",y=")",b="[",_="]",w="{",j="}";for(r[v]=y,r[w]=j,r[b]=_,o=t.value.substring(0,get_cursor_position(t)),n=o.length,i=0;n>i;i+=1)if(e=o[i],u!==m)l?l=!1:e===u?u=m:e===g&&(l=!0);else if(a)e===p&&(a=!1);else switch(e){case v:case w:case b:h.push(e);break;case y:case j:case _:if(h.length<=0)return paren_jump(t,i,"",!0),void 0;if(s=h.pop(),r[s]!==e)return paren_jump(t,i,r[s],!0),void 0;break;case c:u=c;break;case d:u=d;break;case f:a=!0}s=h.pop(),i=o.length,u!==m||a||"undefined"==typeof s||paren_jump(t,i,r[s],!1)}function new_worksheet(){open("/new_worksheet")}function set_worksheet_list_checks(){var t,e,i,n;for(t=get_element("controlbox"),e=0;e<worksheet_filenames.length;e+=1)i=worksheet_filenames[e].replace(/[^\-A-Za-z_0-9]/g,"-"),n=get_element(i),n.checked=t.checked}function checked_worksheet_filenames(){var t,e,i,n=[];for(t=0;t<worksheet_filenames.length;t+=1)e=worksheet_filenames[t].replace(/[^\-A-Za-z_0-9]/g,"-"),i=get_element(e),i.checked&&(n.push(worksheet_filenames[t]),i.checked=0);return encode_response(n)}function worksheet_list_button(t){async_request(t,worksheet_list_button_callback,{filenames:checked_worksheet_filenames()})}function worksheet_list_button_callback(t,e){"success"===t?""!==e&&alert(e):alert(translations["Error applying function to worksheet(s)."]+e),window.location.reload(!0)}function delete_button(){worksheet_list_button("/send_to_trash")}function make_active_button(){worksheet_list_button("/send_to_active")}function archive_button(){worksheet_list_button("/send_to_archive")}function stop_worksheets_button(){worksheet_list_button("/send_to_stop")}function download_worksheets_button(){window.location.replace("/download_worksheets.zip?filenames="+checked_worksheet_filenames())}function history_window(){window.open("/history","","menubar=1,scrollbars=1,width=800,height=600,toolbar=1,resizable=1")}function upload_worksheet_button(){window.location.replace("/upload")}function copy_worksheet(){window.location.replace(worksheet_command("copy"))}function download_worksheet(){var t,e=prompt(translations["Title of saved worksheet"],worksheet_name);e&&(t=open(worksheet_command("download/"+e+".sws")))}function worksheet_settings(){window.location.replace(worksheet_command("settings"))}function share_worksheet(){window.location.replace(worksheet_command("share"))}function publish_worksheet(){window.open(worksheet_command("publish"),"","menubar=1,location=1,scrollbars=1,width=800,height=600,toolbar=1,  resizable=1")}function save_as(t){open(worksheet_command("save_as")+"?typ="+t)}function save_worksheet(){async_request(worksheet_command("save_snapshot"),save_worksheet_callback)}function save_worksheet_callback(t){return"success"!==t?(alert(translations["Failed to save worksheet."]),void 0):void 0}function close_callback(t,e){return"success"!==t?(alert(e),void 0):(window.location.replace("/home/"+user_name),void 0)}function save_worksheet_and_close(){async_request(worksheet_command("save_and_quit"),close_callback)}function worksheet_discard(){async_request(worksheet_command("discard_and_quit"),close_callback)}function rename_worksheet(){var t=function(t){var e,i=$("#worksheet_title");e=t.length>=30?t.slice(0,30)+" ...":t,i.html(e),worksheet_name=t,original_title=worksheet_name+" (Sage)",document.title=original_title,async_request(worksheet_command("rename"),null,{name:t})};modal_prompt({success:function(e){t($(":text",e).prop("value"))}},{id:"rename_prompt",title:translations["Rename worksheet"],message:translations["Please enter a name for this worksheet."],"default":worksheet_name,submit:translations.Rename})}function go_system_select(t){system_select(t.options[t.selectedIndex].value)}function system_select(t){async_request(worksheet_command("system/"+t))}function pretty_print_check(t){async_request(worksheet_command("pretty_print/"+t))}function live_3D_check(t){async_request(worksheet_command("live_3D/"+t))}function handle_data_menu(t){var e=t.options[t.selectedIndex].value;"__upload_data_file__"===e?window.location.replace(worksheet_command("upload_data")):""!==e&&window.location.replace("/home/"+worksheet_filename+"/"+e),t.options[0].selected=1}function delete_worksheet(t){async_request("/send_to_trash",delete_worksheet_callback,{filename:t})}function delete_worksheet_callback(t){"success"===t?window.location.replace("/?typ=trash"):alert(translations["Possible failure deleting worksheet."])}function go_option(form){var action=form.options[form.selectedIndex].value;eval(action),form.options[0].selected=1}function link_datafile(t,e){open(worksheet_command("link_datafile?filename="+escape0(e)+"&target="+escape0(t)),process=!1)}function list_rename_worksheet(t,e){var i=function(e){async_request("/home/"+t+"/"+"rename",refresh,{name:e})};modal_prompt(function(t){i($(":text",t).attr("value"))},{title:translations["Rename worksheet"],message:translations["Please enter a name for this worksheet."],"default":e,submit:translations.Rename})}function list_edit_worksheet(t){window.location.replace("/home/"+t)}function list_copy_worksheet(t){async_request("/home/"+t+"/copy?no_load",refresh)}function list_share_worksheet(t){window.location.replace("/home/"+t+"/share")}function list_publish_worksheet(t){window.open("/home/"+t+"/publish","","menubar=1,scrollbars=1,width=800,height=600,toolbar=1,  resizable=1")}function list_revisions_of_worksheet(t){window.location.replace("/home/"+t+"/revisions")}function server_ping_while_alive(){async_request(worksheet_command("alive"),server_ping_while_alive_callback),setTimeout(function(){server_ping_while_alive()},server_ping_time)}function server_ping_while_alive_callback(t,e){"failure"===t?set_class("ping","pingdown"):(set_class("ping","ping"),state_number>=0&&parseInt(e,10)>state_number&&refresh_cell_list())}function get_cell(t){var e;return t=toint(t),e=cell_element_cache[t],e||(e=get_element("cell_input_"+t),cell_element_cache[t]=e),e}function cell_blur(t){var e,i;return t=toint(t),(e=get_cell(t))?(e.className="cell_input",i=lstrip(e.value).slice(0,5),"%hide"===i&&(e.className="cell_input_hide",e.style.height="1em"),cell_has_changed&&send_cell_input(t),!0):!0}function send_cell_input(t){var e=get_cell(t);e&&(cell_set_not_evaluated(t),async_request(worksheet_command("eval"),null,{save_only:1,id:t,input:e.value}))}function evaluate_text_cell_input(t,e){async_request(worksheet_command("eval"),evaluate_text_cell_callback,{text_only:1,id:t,input:e}),sage_jmol.delete_callback()}function evaluate_text_cell_callback(t,e){var i,n,s;if("failure"!==t){if(s=decode_response(e),-1===s.id)return alert(translations["You requested to evaluate a cell that, for some reason, the server is unaware of."]),void 0;n=get_element("cell_outer_"+s.id),i=separate_script_tags(s.cell_html),$(n).replaceWith(i[0]),n=get_element("cell_outer_"+s.id),setTimeout(i[1],50);try{MathJax.Hub.Queue(["Typeset",MathJax.Hub,n])}catch(o){n.innerHTML="Error typesetting mathematics"+n.innerHTML}}}function cell_focus(t,e){var i;return t=toint(t),(i=get_cell(t))?(cell_input_resize(t),i.focus(),e||set_cursor_position(i,0),cell_has_changed=!1,!0):!0}function cell_focused(t,e){e=toint(e),t.className="cell_input_active",cell_input_resize(e),current_cell!==e&&(-1!==current_cell&&set_class("eval_button"+current_cell,"eval_button"),current_cell=e,set_class("eval_button"+e,"eval_button_active"))}function cell_input_resize(t){var e=get_cell(t),i=get_element("cell_resizer");e&&(i.style.width=e.offsetWidth+"px",i.innerHTML=e.value.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\r?\n/g,"<br>").replace(/\s\s/g," &nbsp;")+"&nbsp;",e.style.height=i.offsetHeight+"px",slide_hidden&&(e.className="cell_input_active",slide_hidden=!1))}function cell_delete(t){-1!==$.inArray(t,queue_id_list)&&async_request(worksheet_command("interrupt")),async_request(worksheet_command("delete_cell"),cell_delete_callback,{id:t}),sage_jmol.delete_callback()}function cell_delete_callback(t,e){var i,n;"failure"!==t&&(n=decode_response(e),"ignore"!==n.command&&(i=get_element("cell_outer_"+n.id),i&&(get_element("worksheet_cell_list").removeChild(i),cell_id_list.splice($.inArray(n.id,cell_id_list),1),delete introspect[n.id],delete cell_element_cache[n.id],in_slide_mode&&(current_cell=-1,slide_mode(),sage_jmol.delete_callback()))))}function cell_delete_output(t){t=toint(t),-1!==$.inArray(t,queue_id_list)&&async_request(worksheet_command("interrupt")),async_request(worksheet_command("delete_cell_output"),cell_delete_output_callback,{id:t}),sage_jmol.delete_callback()}function cell_delete_output_callback(t,e){var i;"success"===t&&(i=decode_response(e),get_element("cell_output_"+i.id).innerHTML="",get_element("cell_output_nowrap_"+i.id).innerHTML="",get_element("cell_output_html_"+i.id).innerHTML="",cell_set_not_evaluated(i.id),sage_jmol.delete_callback())}function cell_input_key_event(t,e){var i,n,s,o,a,r;if(!browser_iphone&&(e=new key_event(e))){if(key_control(e))return control_key_pressed=1,void 0;if(t=toint(t),key_split_cell(e)||key_split_cell_noctrl(e)&&control_key_pressed)return doing_split_eval=!1,split_cell(t),!1;if(key_spliteval_cell(e)||key_enter(e)&&control_key_pressed)return doing_split_eval=!0,jump_to_cell(t,1),control_key_pressed=0,split_cell(t),!1;if(key_join_cell(e)||key_delete_cell(e)&&control_key_pressed||key_delete_cell(e)&&is_whitespace(get_cell(t).value))return control_key_pressed=0,join_cell(t),!1;if(control_key_pressed=0,s=get_cell(t),introspect[t].loaded&&!handle_introspection(t,s,e))return!1;if(r=get_selection_range(s),a=r[0]===r[1],!in_slide_mode&&key_up_arrow(e)&&a)return n=s.value.substring(0,r[0]),o=n.indexOf("\n"),-1===o||""===n?(jump_to_cell(t,-1,!0),!1):!0;if(!in_slide_mode&&key_down_arrow(e)&&a)return i=s.value.substring(r[0]),o=i.indexOf("\n"),-1!==o&&""!==i||t===extreme_compute_cell(-1)?!0:(jump_to_cell(t,1),!1);if(key_send_input(e))return doing_split_eval=!1,evaluate_cell(t,!1),!1;if(key_send_input_newcell(e))return doing_split_eval=!1,evaluate_cell(t,!0),!1;if(key_comment(e)&&!a)return comment_cell(s);if(key_uncomment(e)&&!a)return uncomment_cell(s);if(key_unindent(e))return unindent_cell(s),!1;if(key_request_introspections(e)&&a)return evaluate_cell_introspection(t,null,null),!1;if(key_indent(e)&&!a)return indent_cell(s),!1;if(key_interrupt(e))return interrupt(),!1;if(key_page_down(e))return in_slide_mode?slide_next():jump_to_cell(t,5),!1;if(key_page_up(e))return in_slide_mode?slide_prev():jump_to_cell(t,-5),!1;if(key_request_history(e))history_window();else if(key_request_log(e))text_log_window(worksheet_filename);else if(key_fix_paren(e))return paren_match(s),!1;return key_up_arrow(e)||key_down_arrow(e)||key_menu_right(e)||key_menu_left(e)||(cell_has_changed=!0,introspect[t].changed=!0),!0}}function is_compute_cell(t){return null!==get_cell(t)}function extreme_compute_cell(t){var e,i,n=cell_id_list.length;if(1===t)for(e=0;n>e&&(i=cell_id_list[e],!is_compute_cell(i));e+=1);else for(e=n-1;e>-1&&(i=cell_id_list[e],!is_compute_cell(i));e-=1);return i}function id_of_cell_delta(t,e,i){var n,s,o,a=cell_id_list.length;if(0!==a){if(!e||0===e)return t;if(n=$.inArray(t,cell_id_list),-1===n)return t;for(0>e?(e=-e,o=-1):o=1,s=0;e>s;s+=1)for(n+=o;!i&&n>=0&&a>n&&!is_compute_cell(cell_id_list[n]);)n+=o;return 0>n?n=0:n>=a&&(n=a-1),i||is_compute_cell(cell_id_list[n])?cell_id_list[n]:t}}function jump_to_cell(t,e,i){if(!ignore_all_jumps){if(ignore_next_jump)return ignore_next_jump=!1,void 0;e&&0!==e&&(t=id_of_cell_delta(t,e)),in_slide_mode?jump_to_slide(t):cell_focus(t,i)}}function escape0(t){return t=escape(t),t=t.replace(/\+/g,"%2B")}function text_cursor_split(t){var e,i,n=get_selection_range(t);return i=t.value.substr(0,n[1]),e=t.value.substr(i.length),[i,e]}function indent_cell(t){var e,i,n,s,o,a,r=get_selection_range(t);for(a=1+t.value.lastIndexOf("\n",r[0]),e=t.value.substring(0,a),i=t.value.substring(a,r[1]),n=t.value.substring(r[1]),o=i.split("\n"),s=0;s<o.length;s+=1)o[s]="    "+o[s];i=o.join("\n"),t.value=e+i+n,set_selection_range(t,e.length,e.length+i.length)}function unindent_cell(t){var e,i,n,s,o,a,r=get_selection_range(t);for(a=1+t.value.lastIndexOf("\n",r[0]),e=t.value.substring(0,a),i=t.value.substring(a,r[1]),n=t.value.substring(r[1]),o=i.split("\n"),s=0;s<o.length;s+=1)o[s]=unindent_pat.exec(o[s])[1];i=o.join("\n"),t.value=e+i+n,r[0]===r[1]?set_cursor_position(t,e.length+i.length):set_selection_range(t,e.length,e.length+i.length)}function comment_cell(t){var e,i,n,s,o,a,r=get_selection_range(t);if(r[0]===r[1])return!0;for(a=1+t.value.lastIndexOf("\n",r[0]),e=t.value.substring(0,a),i=t.value.substring(a,r[1]),n=t.value.substring(r[1]),o=i.split("\n"),s=0;s<o.length;s+=1)o[s]="#"+o[s];i=o.join("\n"),t.value=e+i+n,set_selection_range(t,e.length,e.length+i.length)}function uncomment_cell(t){var e,i,n,s,o,a,r,l=get_selection_range(t);if(l[0]===l[1])return!0;for(r=1+t.value.lastIndexOf("\n",l[0]),e=t.value.substring(0,r),i=t.value.substring(r,l[1]),n=t.value.substring(l[1]),o=i.split("\n"),s=0;s<o.length;s+=1)a=uncomment_pat.exec(o[s]),o[s]=a[1]+a[2];i=o.join("\n"),t.value=e+i+n,set_selection_range(t,e.length,e.length+i.length)}function join_cell(t){var e,i,n,s,o,a;return s=id_of_cell_delta(t,-1),e=get_cell(t),s===t?is_whitespace(e.value)?(i=get_cell(id_of_cell_delta(t,1)),i.focus(),cell_delete(t),void 0):void 0:(n=get_cell(s),is_whitespace(e.value)?(n.focus(),cell_delete(t),void 0):(a=n.value,e.focus(),cell_delete(s),o=a.length,"\n"!==a[o-1]&&(a+="\n",o+=1),e.value=a+e.value,send_cell_input(t),set_cursor_position(e,o),cell_input_resize(t),void 0))}function split_cell(t){var e=get_cell(t),i=text_cursor_split(e);i[1].length>0&&"\n"===i[1][0]&&(i[1]=i[1].slice(1)),e.value=i[1],cell_input_resize(t),send_cell_input(t),set_cursor_position(e,0),ignore_next_jump=!0,insert_new_cell_before(t,i[0])}function worksheet_command(t){return("eval"===t||"new_cell_before"===t||"new_cell_after"===t||"new_text_cell_before"===t||"new_text_cell_after"===t)&&(state_number=parseInt(state_number,10)+1),"/home/"+worksheet_filename+"/"+t}function evaluate_cell(t,e){var i;return worksheet_locked?(alert(translations["This worksheet is read only. Please make a copy or contact the owner to change it."]),void 0):(t=toint(t),i=get_cell(t),i&&(e=e||t===extreme_compute_cell(-1)?1:0,evaluating_all&&(e=0),cell_has_changed=!1,async_request(worksheet_command("eval"),evaluate_cell_callback,{newcell:e,id:t,input:i.value}),sage_jmol.delete_callback()),void 0)}function evaluate_cell_introspection(t,e,i){var n,s,o,a,r;if(t=toint(t),a=introspect[t],n=get_cell(t),null===e)if(halt_introspection(t),o=text_cursor_split(n),e=o[0],i=o[1],a.before_replacing_word=e,a.after_cursor=i,r=command_pat.exec(e),s=function_pat.exec(e),"?"===e.slice(-1))a.docstring=!0;else if(r)a.replacing=!0,a.replacing_word=r[1],a.before_replacing_word=e.substring(0,e.length-r[1].length);else{if(null===s)return cell_has_changed=!0,do_replacement(t,"    ",!1),void 0;e=s[1]+"?",a.docstring=!0}async_request(worksheet_command("introspect"),evaluate_cell_callback,{id:t,before_cursor:e,after_cursor:i})}function evaluate_cell_callback(t,e){function i(t,e){var i,s,o=[n.next_id,id_of_cell_delta(n.id,1)];if(n.interact)return!0;for(i=0;i<o.length;i+=1)if(s=o[i],s!==n.id&&is_compute_cell(s))return t&&evaluate_cell(s,!1),e&&jump_to_cell(s,0),!0;return!1}var n;"failure"!==t&&(n=decode_response(e),n.interact=n.interact?!0:!1,-1!==n.id&&(n.command&&"error"===n.command.slice(0,5)||(queue_id_list.push(n.id),cell_set_running(n.id,n.interact),evaluating_all&&(i(!0,!1)||(evaluating_all=!1)),"insert_cell"===n.command?(do_insert_new_cell_after(n.id,n.new_cell_id,n.new_cell_html),jump_to_cell(n.new_cell_id,0)):"introspect"===n.command?(introspect[n.id].loaded=!1,update_introspection_text(n.id,"loading...")):in_slide_mode||doing_split_eval||is_interacting_cell(n.id)||i(!1,!0),start_update_check(),sage_jmol.delete_callback())))}function is_interacting_cell(t){return null!==get_element("cell-interact-"+t)}function cell_output_set_type(t,e,i){"nowrap"===e&&is_interacting_cell(t)&&(e="hidden"),set_class("cell_div_output_"+t,"cell_div_output_"+e),set_class("cell_output_"+t,"cell_output_"+e),set_class("cell_output_nowrap_"+t,"cell_output_nowrap_"+e),set_class("cell_output_html_"+t,"cell_output_html_"+e),i&&async_request(worksheet_command("set_cell_output_type"),null,{id:t,type:e})}function cycle_cell_output_type(t){var e;return t=toint(t),e=get_element("cell_div_output_"+t),"cell_div_output_hidden"===e.className||"cell_div_output_running"===e.className?(cell_output_set_type(t,"wrap"),void 0):("cell_div_output_wrap"===e.className?cell_output_set_type(t,"nowrap"):cell_output_set_type(t,"hidden"),void 0)}function cell_set_evaluated(t){var e=get_element("cell_"+t);e.className="cell_evaluated"}function cell_set_not_evaluated(t){var e=get_element("cell_"+t);e.className="cell_not_evaluated",cell_set_done(t)}function cell_set_running(t,e){var i,n,s;t=toint(t),e?(s=get_element("cell_output_html_"+t),s&&(s.innerHTML="")):(set_output_text(t,"","","","","",!0),i=get_element("cell_div_output_"+t),"cell_div_output_hidden"===i.className&&cycle_cell_output_type(t),i.className="cell_output_running"),n=get_element("cell_number_"+t),n.className="cell_number_running"}function cell_set_done(t){var e,i;e=get_element("cell_div_output_"+t),e.className="cell_div_output_wrap",i=get_element("cell_number_"+t),i.className="cell_number"}function check_for_cell_update(){var t,e,i;if(0===queue_id_list.length)return cancel_update_check(),void 0;update_time=time_now(),t=queue_id_list[0],async_request(worksheet_command("cell_update"),check_for_cell_update_callback,{id:t});try{title_spinner_i=(title_spinner_i+1)%title_spinner.length,e=title_spinner[title_spinner_i]+original_title,i=queue_id_list.length,i>1&&(e=i+" "+e),document.title=e}catch(n){}}function check_for_cell_update_callback(t,e){var i,n,s,o;return"success"!==t?update_error_count>update_error_threshold?(cancel_update_check(),halt_queued_cells(),i=update_error_count*update_error_delta/1e3,s=translations["Error updating cell output after "]+" "+i+translations["s (canceling further update checks)."],void 0):(cell_output_delta=update_error_delta,update_error_count+=1,continue_update_check(),void 0):(update_error_count>0&&(update_error_count=0,update_count=0,update_falloff_level=1,cell_output_delta=update_falloff_deltas[1]),""===e?(continue_update_check(),void 0):(o=decode_response(e),"e"===o.status?(cancel_update_check(),halt_queued_cells(),void 0):(n=set_output_text(o.id,o.status,o.output,o.output_wrapped,o.output_html,o.introspect_html,!1),"d"===o.status?(cell_set_done(o.id),queue_id_list.splice($.inArray(o.id,queue_id_list),1),"restart"===o.interrupted?restart_sage():"false"===o.interrupted?cell_set_evaluated(o.id):(cancel_update_check(),halt_queued_cells()),0===queue_id_list.length&&cancel_update_check(),""!==o.new_input&&set_input_text(o.id,o.new_input),update_count=0,update_falloff_level=0,cell_output_delta=update_falloff_deltas[0]):update_count>update_falloff_threshold&&update_falloff_level+1<update_falloff_deltas.length?(update_falloff_level+=1,update_count=0,cell_output_delta=update_falloff_deltas[update_falloff_level]):update_count+=1,"trigger_interact"===n?interact(o.id,{},1):"restart_interact"===n&&evaluate_cell(o.id,0),continue_update_check(),void 0)))}function continue_update_check(){var t=time_now()-update_time;cell_output_delta>t?update_timeout=setTimeout(function(){check_for_cell_update()},cell_output_delta-t):check_for_cell_update()}function start_update_check(){updating||(updating=!0,update_count=0,update_falloff_level=0,cell_output_delta=update_falloff_deltas[0],check_for_cell_update())}function cancel_update_check(){updating=!1,clearTimeout(update_timeout),document.title=original_title,reset_interrupts()}function set_output_text(t,e,i,n,s,o,a){var r,l,h,u,c,d,f;if("number"==typeof t&&0>t)return!1;if("d"!==e||is_interacting_cell(t)||(n=eval_script_tags(n),s=eval_script_tags(s)),!a&&is_interacting_cell(t))return"d"!==e?!1:(c=n.indexOf(INTERACT_START),d=n.indexOf(INTERACT_END),-1!==n.indexOf(INTERACT_RESTART)?"restart_interact":-1===c||-1===d?!1:(f=n.slice(c+16,d),f=eval_script_tags(f),r=get_element("cell-interact-"+t),r.innerHTML=f,MathJax.Hub.Queue(["Typeset",MathJax.Hub,r]),!1));if(l=get_element("cell_output_"+t),!l)return!1;if(u=get_element("cell_output_nowrap_"+t),h=get_element("cell_output_html_"+t),l.innerHTML=n,u.innerHTML=i,h.innerHTML=s,"d"===e)try{MathJax.Hub.Queue(["Typeset",MathJax.Hub,l])}catch(p){l.innerHTML="Error typesetting mathematics"+l.innerHTML,u.innerHTML="Error typesetting mathematics"+u.innerHTML}return"d"===e&&(""!==o?(introspect[t].loaded=!0,update_introspection_text(t,o)):halt_introspection(t)),"d"===e&&""===o&&is_interacting_cell(t)?"trigger_interact":!1}function set_input_text(t,e){var i,n=get_cell(t);return n.value=e,jump_to_cell(t,0),i=e.length-introspect[t].after_cursor.length,set_cursor_position(n,i),!1}function CellWriter(){this.buffer="",this.write=function(t){this.buffer+=t}}function eval_script_tags(text){var i,j,k,left_tag,right_tag,s,script,new_text,script_end,left_match;for(left_tag=new RegExp(/<(\s)*script([^>]*)?>/i),right_tag=new RegExp(/<(\s*)\/(\s*)script(\s)*>/i),script="",new_text="",s=text,i=s.search(left_tag);-1!==i&&(left_match=s.match(left_tag),j=s.search(right_tag),k=i+(left_match[0]+"").length,script_end=j+(s.match(right_tag)[0]+"").length,!(-1===j||k>j));){if(left_match[2]&&-1!==left_match[2].indexOf("math/tex"))new_text+=s.slice(0,script_end);else{code=s.slice(k,j);try{cell_writer=new CellWriter,eval(code)}catch(e){alert(e)}new_text+=s.slice(0,i)+cell_writer.buffer}s=s.slice(script_end),i=s.search(left_tag)}return new_text+=s}function separate_script_tags(t){var e,i,n,s,o,a,r,l,h,u;for(s=new RegExp(/<(\s)*script([^>]*)?>/i),o=new RegExp(/<(\s*)\/(\s*)script(\s)*>/i),r="",l="",a=t,e=a.search(s);-1!==e&&(u=a.match(s),i=a.search(o),n=e+(u[0]+"").length,h=i+(a.match(o)[0]+"").length,!(-1===i||n>i));)u[2]&&-1!==u[2].indexOf("math/tex")?l+=a.slice(0,h):(r+=a.slice(n,i),l+=a.slice(0,e)),a=a.slice(h),e=a.search(s);
return l+=a,[l,r]}function slide_mode(){var t,e,i=cell_id_list.length;for(in_slide_mode=!0,set_class("left_pane","hidden"),set_class("cell_controls","hidden"),set_class("slide_controls","slide_control_commands"),set_class("left_pane_bar","hidden"),t=0;i>t;t+=1)e=cell_id_list[t],is_compute_cell(e)&&set_class("cell_outer_"+e,"hidden");slide_show()}function cell_mode(){var t,e,i=cell_id_list.length;for(in_slide_mode=!1,set_class("left_pane","pane"),set_class("cell_controls","control_commands"),set_class("slide_controls","hidden"),set_class("worksheet","worksheet"),set_class("left_pane_bar","left_pane_bar"),t=0;i>t;t+=1)e=cell_id_list[t],is_compute_cell(e)&&set_class("cell_outer_"+e,"cell_visible")}function slide_hide(){set_class("cell_outer_"+current_cell,"hidden")}function slide_show(){var t,e;-1!==current_cell?set_class("cell_outer_"+current_cell,"cell_visible"):(cell_id_list.length>0&&(current_cell=extreme_compute_cell(1)),set_class("cell_outer_"+current_cell,"cell_visible")),-1!==current_cell&&(t=get_cell(current_cell),t||(e=lstrip(t.value).slice(0,5),cell_focus(current_cell,!1),"%hide"===e&&(slide_hidden=!0,t.className="cell_input_hide",t.style.height="1.5em"))),update_slideshow_progress()}function slide_first(){jump_to_slide(extreme_compute_cell(1))}function slide_last(){jump_to_slide(extreme_compute_cell(-1))}function slide_next(){jump_to_slide(id_of_cell_delta(current_cell,1))}function slide_prev(){jump_to_slide(id_of_cell_delta(current_cell,-1))}function jump_to_slide(t){slide_hide(),current_cell=toint(t),slide_show()}function update_slideshow_progress(){var t,e,i,n;e=$.inArray(current_cell,cell_id_list)+1,i=cell_id_list.length,t=get_element("slideshow_progress_bar"),t&&(t.style.width=""+100*e/i+"%"),n=get_element("slideshow_progress_text"),n&&(n.innerHTML=e+" / "+i)}function make_new_cell(t,e){var i,n,s;return s=separate_script_tags(e),n=document.createElement("div"),i=document.createElement("div"),n.appendChild(i),n.id="cell_outer_"+t,i.id="cell_"+t,i.innerHTML=s[0],setTimeout(s[1],50),halt_introspection(t),n}function make_new_text_cell(t,e){var i,n;return n=separate_script_tags(e),i=$(n[0]),setTimeout(n[1],50),i}function do_insert_new_cell_before(t,e,i){var n,s=make_new_cell(e,i);$("#cell_outer_"+t).before(s),n=$.inArray(t,cell_id_list),cell_id_list.splice(n,0,e),doing_split_eval&&(evaluate_cell(t,!1),evaluate_cell(e,!1))}function do_insert_new_text_cell_before(t,e,i){var n,s=make_new_text_cell(e,i);$("#cell_outer_"+t).before(s),n=$.inArray(t,cell_id_list),cell_id_list.splice(n,0,e)}function insert_new_cell_after(t,e){e=e||"",async_request(worksheet_command("new_cell_after"),insert_new_cell_after_callback,{id:t,input:e})}function insert_new_cell_after_callback(t,e){var i;return"failure"===t?(alert(translations["Problem inserting new input cell after current input cell.\\n"]+e),void 0):"locked"===e?(alert(translations["Worksheet is locked. Cannot insert cells."]),void 0):(i=decode_response(e),do_insert_new_cell_after(i.id,i.new_id,i.new_html),jump_to_cell(i.new_id,0),void 0)}function insert_new_text_cell_after(t,e){e=e||"",async_request(worksheet_command("new_text_cell_after"),insert_new_text_cell_after_callback,{id:t,input:e})}function insert_new_text_cell_after_callback(t,e){var i;return"failure"===t?(alert(translations["Problem inserting new text cell before current input cell."]),void 0):"locked"===e?(alert(translations["Worksheet is locked. Cannot insert cells."]),void 0):(i=decode_response(e),do_insert_new_text_cell_after(i.id,i.new_id,i.new_html),void 0)}function do_insert_new_cell_after(t,e,i){var n=id_of_cell_delta(t,1);n===t?append_new_cell(e,i):do_insert_new_cell_before(n,e,i)}function do_insert_new_text_cell_after(t,e,i){var n=id_of_cell_delta(t,1);n===t?append_new_text_cell(e,i):do_insert_new_text_cell_before(n,e,i)}function insert_new_cell_before(t,e){e=e||"",async_request(worksheet_command("new_cell_before"),insert_new_cell_before_callback,{id:t,input:e})}function insert_new_cell_before_callback(t,e){var i;return"failure"===t?(alert(translations["Problem inserting new input cell before current input cell.\\n"]+e),void 0):"locked"===e?(alert(translations["Worksheet is locked. Cannot insert cells."]),void 0):(i=decode_response(e),do_insert_new_cell_before(i.id,i.new_id,i.new_html),jump_to_cell(i.new_id,0),void 0)}function insert_new_text_cell_before(t,e){e=e||"",async_request(worksheet_command("new_text_cell_before"),insert_new_text_cell_before_callback,{id:t,input:e})}function insert_new_text_cell_before_callback(t,e){var i;return"failure"===t?(alert(translations["Problem inserting new text cell before current input cell.\\n"]+e),void 0):"locked"===e?(alert(translations["Worksheet is locked. Cannot insert cells."]),void 0):(i=decode_response(e),do_insert_new_text_cell_before(i.id,i.new_id,i.new_html),void 0)}function append_new_cell(t,e){var i,n;i=make_new_cell(t,e),n=get_element("worksheet_cell_list"),n.appendChild(i),cell_id_list.push(t),in_slide_mode?(set_class("cell_outer_"+t,"hidden"),update_slideshow_progress()):jump_to_cell(t,0)}function append_new_text_cell(t,e){var i=make_new_text_cell(t,e);$("#worksheet_cell_list").append(i),cell_id_list.push(t)}function interrupt(){updating&&async_request(worksheet_command("interrupt"),interrupt_callback)}function reset_interrupts(){var t=interrupt_state;t.alert&&t.alert.achtung("close"),t.alert=null,t.count=0}function evaluate_all(){evaluating_all=!0,evaluate_cell(extreme_compute_cell(1),!1)}function hide_all(){var t,e,i=cell_id_list.length;for(t=0;i>t;t+=1)e=cell_id_list[t],is_compute_cell(e)&&cell_output_set_type(e,"hidden",!1);async_request(worksheet_command("hide_all"))}function show_all(){var t,e,i=cell_id_list.length;for(t=0;i>t;t+=1)e=cell_id_list[t],is_compute_cell(e)&&cell_output_set_type(e,"wrap",!1);async_request(worksheet_command("show_all"))}function delete_all_output(){var t,e,i=cell_id_list.length;for(t=0;i>t;t+=1)e=cell_id_list[t],is_compute_cell(e)&&(get_element("cell_output_"+e).innerHTML="",get_element("cell_output_nowrap_"+e).innerHTML="",get_element("cell_output_html_"+e).innerHTML="",cell_set_not_evaluated(e));async_request(worksheet_command("delete_all_output")),sage_jmol.delete_all_callback()}function halt_queued_cells(){var t;for(t=0;t<queue_id_list.length;t+=1)cell_set_not_evaluated(queue_id_list[t]);queue_id_list.splice(0,queue_id_list.length),reset_interrupts()}function set_all_cells_to_be_not_evaluated(){var t,e,i=cell_id_list.length;for(t=0;i>t;t+=1)e=cell_id_list[t],is_compute_cell(e)&&cell_set_not_evaluated(e)}function restart_sage(){halt_queued_cells(),set_all_cells_to_be_not_evaluated(),async_request(worksheet_command("restart_sage"))}function quit_sage(){halt_queued_cells(),set_all_cells_to_be_not_evaluated(),async_request(worksheet_command("quit_sage"))}function login(t,e){document.cookie="username="+t,document.cookie="password="+e,window.location="/"}function history_window(){window.open("/history","","menubar=1,scrollbars=1,width=800,height=600, toolbar=1,resizable=1")}function print_worksheet(){window.open(worksheet_command("print"),"","menubar=1,scrollbars=1,width=800,height=600,toolbar=1,  resizable=1")}function help(){window.open("/help","","menubar=1,location=1,scrollbars=1,width=800,height=650,toolbar=1,  resizable=1")}function bugreport(){window.open("http://sagemath.org/report-issue","","menubar=1,location=1,scrollbars=1,width=800,height=650,toolbar=1,  resizable=1")}function interact(t,e,i){t=toint(t),cell_has_changed=!1,current_cell=t,e=e||{},async_request(worksheet_command("eval"),evaluate_cell_callback,{id:t,interact:1,variable:e.variable||"",adapt_number:e.adapt_number||-1,value:e.value||"",recompute:i,newcell:0})}function encode64(t){var e,i,n,s,o,a,r,l=0,h="";try{t=t.toString()}catch(u){return t}for(;l<t.length;)e=t.charCodeAt(l++),i=t.charCodeAt(l++),n=t.charCodeAt(l++),s=e>>2,o=(3&e)<<4|i>>4,a=(15&i)<<2|n>>6,r=63&n,isNaN(i)?(a=64,r=64):isNaN(n)&&(r=64),h=h+keyStr.charAt(s)+keyStr.charAt(o)+keyStr.charAt(a)+keyStr.charAt(r);return h}function decode64(t){var e,i,n,s,o,a,r,l=0,h="";for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<t.length;)s=keyStr.indexOf(t.charAt(l++)),o=keyStr.indexOf(t.charAt(l++)),a=keyStr.indexOf(t.charAt(l++)),r=keyStr.indexOf(t.charAt(l++)),e=s<<2|o>>4,i=(15&o)<<4|a>>2,n=(3&a)<<6|r,h+=String.fromCharCode(e),64!==a&&(h+=String.fromCharCode(i)),64!==r&&(h+=String.fromCharCode(n));return h}function empty_trash(){confirm(translations["Emptying the trash will permanently delete all items in the trash. Continue?"])&&$("#empty-trash-form").submit()}var cell_id_list=[],queue_id_list=[],onload_id_list=[],cell_element_cache={},worksheet_locked,original_title=document.title,state_number=-1,worksheet_filename="",worksheet_name="",user_name="",server_ping_time=1e4,INTERACT_RESTART="__SAGE_INTERACT_RESTART__",INTERACT_START="<?__SAGE__START>",INTERACT_END="<?__SAGE__END>",browser_op,browser_saf,browser_konq,browser_moz,browser_ie,browser_iphone,os_mac,os_lin,os_win,input_keypress,input_keydown,skip_keyup=!1,interrupt_state={count:0},current_cell=-1,cell_has_changed=!1,keypress_resize_delay=250,last_keypress_resize=0,will_resize_soon=!1,previous={},doing_split_eval=!1,ignore_next_jump=!1,ignore_all_jumps=!1,control_key_pressed=0,evaluating_all=!1,update_timeout=-1,updating=!1,update_time=-1,update_count=0,update_falloff_threshold=20,update_falloff_level=0,update_falloff_deltas=[250,500,1e3,5e3],update_error_count=0,update_error_threshold=30,update_error_delta=1024,update_normal_delta=update_falloff_deltas[0],cell_output_delta=update_normal_delta,introspect={},non_word="[^a-zA-Z0-9_]",command_pat="([a-zA-Z_][a-zA-Z._0-9]*)$",function_pat="([a-zA-Z_][a-zA-Z._0-9]*)\\([^()]*$",one_word_pat="([a-zA-Z_][a-zA-Z._0-9]*)",unindent_pat="^\\s{0,4}(.*)$",uncomment_pat="^([^\\#]*)\\#{0,1}(.*)$",whitespace_pat="(\\s*)";try{non_word=new RegExp(non_word),command_pat=new RegExp(command_pat),function_pat=new RegExp(function_pat),one_word_pat=new RegExp(one_word_pat),whitespace_pat=new RegExp(whitespace_pat),unindent_pat=new RegExp(unindent_pat),uncomment_pat=new RegExp(uncomment_pat)}catch(e){}var cell_writer=document,in_slide_mode=!1,slide_hidden=!1,title_spinner_i=0,title_spinner=["/ ","\\ "],modal_prompt_element='<div class="modal-prompt" style="display: none;">    <form>        <div class="message"></div>        <div class="field">            <input type="text" />        </div>        <div class="button-div">            <button type="submit">OK</submit>        </div>    </form></div>';input_keypress=true_function,String.prototype.replaceAll=function(t,e){return this.replace(new RegExp(t,"g"),e)};var keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";