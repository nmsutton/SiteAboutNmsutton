jQuery.fn.farbtastic=function(e){return $.farbtastic(this,e),this},jQuery.farbtastic=function(e,t){var e=$(e).get(0);return e.farbtastic||(e.farbtastic=new jQuery._farbtastic(e,t))},jQuery._farbtastic=function(e,t){var n=this;$(e).html('<div class="farbtastic"><div class="color"></div><div class="wheel"></div><div class="overlay"></div><div class="h-marker marker"></div><div class="sl-marker marker"></div></div>');var a=$(".farbtastic",e);n.wheel=$(".wheel",e).get(0),n.radius=84,n.square=100,n.width=194,navigator.appVersion.match(/MSIE [0-6]\./)&&$("*",a).each(function(){if("none"!=this.currentStyle.backgroundImage){var e=this.currentStyle.backgroundImage;e=this.currentStyle.backgroundImage.substring(5,e.length-2),$(this).css({backgroundImage:"none",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=crop, src='"+e+"')"})}}),n.linkTo=function(e){return"object"==typeof n.callback&&$(n.callback).unbind("keyup",n.updateValue),n.color=null,"function"==typeof e?n.callback=e:("object"==typeof e||"string"==typeof e)&&(n.callback=$(e),n.callback.bind("keyup",n.updateValue),n.callback.get(0).value&&n.setColor(n.callback.get(0).value)),this},n.updateValue=function(){this.value&&this.value!=n.color&&n.setColor(this.value)},n.setColor=function(e){var t=n.unpack(e);return n.color!=e&&t&&(n.color=e,n.rgb=t,n.hsl=n.RGBToHSL(n.rgb),n.updateDisplay()),this},n.setHSL=function(e){return n.hsl=e,n.rgb=n.HSLToRGB(e),n.color=n.pack(n.rgb),n.updateDisplay(),this},n.widgetCoords=function(e){var t,a,r=e.target||e.srcElement,i=n.wheel;if("undefined"!=typeof e.offsetX){for(var o={x:e.offsetX,y:e.offsetY},s=r;s;)s.mouseX=o.x,s.mouseY=o.y,o.x+=s.offsetLeft,o.y+=s.offsetTop,s=s.offsetParent;for(var s=i,l={x:0,y:0};s;){if("undefined"!=typeof s.mouseX){t=s.mouseX-l.x,a=s.mouseY-l.y;break}l.x+=s.offsetLeft,l.y+=s.offsetTop,s=s.offsetParent}for(s=r;s;)s.mouseX=void 0,s.mouseY=void 0,s=s.offsetParent}else{var o=n.absolutePosition(i);t=(e.pageX||0*(e.clientX+$("html").get(0).scrollLeft))-o.x,a=(e.pageY||0*(e.clientY+$("html").get(0).scrollTop))-o.y}return{x:t-n.width/2,y:a-n.width/2}},n.mousedown=function(e){document.dragging||($(document).bind("mousemove",n.mousemove).bind("mouseup",n.mouseup),document.dragging=!0);var t=n.widgetCoords(e);return n.circleDrag=2*Math.max(Math.abs(t.x),Math.abs(t.y))>n.square,n.mousemove(e),!1},n.mousemove=function(e){var t=n.widgetCoords(e);if(n.circleDrag){var a=Math.atan2(t.x,-t.y)/6.28;0>a&&(a+=1),n.setHSL([a,n.hsl[1],n.hsl[2]])}else{var r=Math.max(0,Math.min(1,-(t.x/n.square)+.5)),i=Math.max(0,Math.min(1,-(t.y/n.square)+.5));n.setHSL([n.hsl[0],r,i])}return!1},n.mouseup=function(){$(document).unbind("mousemove",n.mousemove),$(document).unbind("mouseup",n.mouseup),document.dragging=!1},n.updateDisplay=function(){var e=6.28*n.hsl[0];$(".h-marker",a).css({left:Math.round(Math.sin(e)*n.radius+n.width/2)+"px",top:Math.round(-Math.cos(e)*n.radius+n.width/2)+"px"}),$(".sl-marker",a).css({left:Math.round(n.square*(.5-n.hsl[1])+n.width/2)+"px",top:Math.round(n.square*(.5-n.hsl[2])+n.width/2)+"px"}),$(".color",a).css("backgroundColor",n.pack(n.HSLToRGB([n.hsl[0],1,.5]))),"object"==typeof n.callback?($(n.callback).css({backgroundColor:n.color,color:n.hsl[2]>.5?"#000":"#fff"}),$(n.callback).each(function(){this.value&&this.value!=n.color&&(this.value=n.color)})):"function"==typeof n.callback&&n.callback.call(n,n.color)},n.absolutePosition=function(e){var t={x:e.offsetLeft,y:e.offsetTop};if(e.offsetParent){var a=n.absolutePosition(e.offsetParent);t.x+=a.x,t.y+=a.y}return t},n.pack=function(e){var t=Math.round(255*e[0]),n=Math.round(255*e[1]),a=Math.round(255*e[2]);return"#"+(16>t?"0":"")+t.toString(16)+(16>n?"0":"")+n.toString(16)+(16>a?"0":"")+a.toString(16)},n.unpack=function(e){return 7==e.length?[parseInt("0x"+e.substring(1,3))/255,parseInt("0x"+e.substring(3,5))/255,parseInt("0x"+e.substring(5,7))/255]:4==e.length?[parseInt("0x"+e.substring(1,2))/15,parseInt("0x"+e.substring(2,3))/15,parseInt("0x"+e.substring(3,4))/15]:void 0},n.HSLToRGB=function(e){var t,n,a=e[0],r=e[1],i=e[2];return n=.5>=i?i*(r+1):i+r-i*r,t=2*i-n,[this.hueToRGB(t,n,a+.33333),this.hueToRGB(t,n,a),this.hueToRGB(t,n,a-.33333)]},n.hueToRGB=function(e,t,n){return n=0>n?n+1:n>1?n-1:n,1>6*n?e+6*(t-e)*n:1>2*n?t:2>3*n?e+6*(t-e)*(.66666-n):e},n.RGBToHSL=function(e){var t,n,a,r,i,o,s=e[0],l=e[1],c=e[2];return t=Math.min(s,Math.min(l,c)),n=Math.max(s,Math.max(l,c)),a=n-t,o=(t+n)/2,i=0,o>0&&1>o&&(i=a/(.5>o?2*o:2-2*o)),r=0,a>0&&(n==s&&n!=l&&(r+=(l-c)/a),n==l&&n!=c&&(r+=2+(c-s)/a),n==c&&n!=s&&(r+=4+(s-l)/a),r/=6),[r,i,o]},$("*",a).mousedown(n.mousedown),n.setColor("#000000"),t&&n.linkTo(t)};